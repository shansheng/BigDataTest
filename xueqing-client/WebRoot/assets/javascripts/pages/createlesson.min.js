var pattern=/^[^('"\\?,\uff0c)]+$/;$(function(){$("#course").addClass("active");$("#datepicker3").datetimepicker({minView:"month",language:"zh-CN",autoclose:!0,format:"yyyy-mm-dd"}).on("hide",function(a){""==$("#datepicker3").val()?$("#datepicker3Msg").show():$("#datepicker3Msg").hide()});$("#datepicker4").datetimepicker({minView:"month",language:"zh-CN",autoclose:!0,format:"yyyy-mm-dd"}).on("hide",function(a){""!=$("#datepicker4").val()&&""!=$("#datepicker3").val()&&(new Date($("#datepicker3").val())).getTime()>(new Date($("#datepicker4").val())).getTime()?$("#datepicker4Msg").show():$("#datepicker4Msg").hide()});$("#datepicker8").datetimepicker({minView:"month",language:"zh-CN",autoclose:!0,format:"yyyy-mm-dd"}).on("hide",function(a){""==$("#datepicker8").val()?$("#datepicker8Msg").show():$("#datepicker8Msg").hide()});$("#datepicker9").datetimepicker({minView:"month",language:"zh-CN",autoclose:!0,format:"yyyy-mm-dd"}).on("hide",function(a){""!=$("#datepicker9").val()&&""!=$("#datepicker8").val()&&(new Date($("#datepicker8").val())).getTime()>(new Date($("#datepicker9").val())).getTime()?$("#datepicker9Msg").show():$("#datepicker9Msg").hide()});$("#yearly").datetimepicker({format:"yyyy",language:"zh-CN",startView:"decade",minView:"decade",autoclose:!0}).on("hide",function(a){""==$("#yearly").val()?$("#yearlyMsg").show():($("#yearlyMsg").hide(),initTeachingTaskBaseCourse())})});function appendPlan(){var a;a='\x3cinput type\x3d"hidden" id\x3d"planid"\x3e\x3cinput class\x3d"form-control" id\x3d"chooseplan" type\x3d"text" onclick\x3d"showMenu(); return false;" readonly\x3d"true" placeholder\x3d"\u8bf7\u9009\u62e9\u57f9\u517b\u65b9\u6848"\x3e\x3cdiv id\x3d"menuContent" class\x3d"menuContent" style\x3d"display:none; position: absolute;z-index: 500;"\x3e\x3cdiv id\x3d"tree2" class\x3d"ztree" style\x3d"margin-top:0; width:301px;border: 1px solid #617775;background: #f0f6e4;position:absolute; height:102px; overflow:auto"\x3e\x3c/div\x3e\x3c/div\x3e\x3cspan id\x3d"tree2Msg" class\x3d"help-block" style\x3d"display:none"\x3e\u8bf7\u9009\u62e9\u57f9\u517b\u65b9\u6848\x3c/span\x3e';$("#appendplan").html(a)}function createCourse(){appendPlan();initPlan();$("input[type\x3dradio][name\x3dnature][value\x3d1]").prop("checked",!0);$("#addorder").modal("show");showpart(1);$("input[type\x3dradio][name\x3dispublic][value\x3d0]").prop("checked",!0)}function ordername2MsgHide(){var a=$.trim($("#ordername2").val());pattern.test(a)?$("#ordername2Msg").hide():$("#ordername2Msg").show()}function showpart(a){1==a?($("#part0").show(),$("#part1").hide(),getCourse4Teaching()):($("#part1").show(),$("#part0").hide(),initbasecourse())}function hidemessage(){$("#addorder").modal("hide");$("input[type\x3dradio][name\x3dnature][value\x3d1]").prop("checked",!0);$("#ordername2").val("");$("#teachingtaskcourse").val("");$("#datepicker3").val("");$("#datepicker4").val("");$("#datepicker8").val("");$("#datepicker9").val("");$("#tree2Msg").hide();$("#yearly").val("");$("#yearlyMsg").hide();$("#teachingtaskbasecourseMsg").hide();$("#teachingtaskcourseMsg").hide();$("#ordername2Msg").hide();$("#bcourseinputMsg").hide();$("#bcourseinputMsg1").hide();$("#teachingtaskbasecourse").html("");$("#datepicker4Msg").hide();$("#datepicker9Msg").hide();showminus()}function initbasecourse(){$.ajax({url:contextPath+"/teacher/initbasecourse",type:"post",data:{},success:function(a){if(a.success){a=a.other;for(var b="",c=0;c<a.length;c++)b+="\x3coption value\x3d"+a[c].id+"\x3e"+a[c].name+"\x3c/option\x3e";$("#bcourse").html(b);getCourse()}else b+="\x3coption value\x3d'-1'\x3e\x3c/option\x3e",$("#bcourse").html(b),$("#bcourse").attr("disabled",!0)}})}function getCourse4Teaching(){var a=$("input[name\x3d'nature']:checked").val(),a={bcname:$.trim($("#teachingtaskbasecourse  option:selected").text()),nature:a};$.ajax({url:contextPath+"/teacher/getByBaseCourseNew4Teaching",type:"post",data:a,success:function(a){if(a.success){a=a.other;var c="\x3coption value\x3d'-1'\x3e--\x3c/option\x3e",d;for(d in a)c+="\x3coption value\x3d'"+a[d].id+"'\x3e"+a[d].name+"\x3c/option\x3e";$("#orderSel").html(c)}else $("#orderSel").html("\x3coption value\x3d'-1'\x3e--\x3c/option\x3e")}})}function getCourse(){var a=$("input[name\x3d'nature']:checked").val(),b=$("#bcourse").val(),c=$("#bcourse").find("option:selected").text();$("#bcourseinput").val(c);0< !b||$.ajax({url:contextPath+"/teacher/getByBaseCourseNew",type:"post",data:{bcid:b,nature:a},success:function(a){if(a.success){a=a.other;var c="\x3coption value\x3d'-1'\x3e--\x3c/option\x3e",b;for(b in a)c+="\x3coption value\x3d'"+a[b].id+"'\x3e"+a[b].name+"\x3c/option\x3e";$("#orderSel").html(c)}}})}function teachingtaskcourseMsgHide(){var a=$.trim($("#teachingtaskcourse").val());pattern.test(a)?$("#teachingtaskcourseMsg").hide():$("#teachingtaskcourseMsg").show()}function saveorder(){var a=$("#orderSel").val();if(1==$("input[name\x3dnature][value\x3d1]").prop("checked"))if(""==$("#planid").val()||null==$("#planid").val())$("#tree2Msg").show();else{var b=$("#yearly").val();if(""==b)$("#yearlyMsg").show();else{var c=$.trim($("#teachingtaskbasecourse  option:selected").text()),d=$("#teachingtaskbasecourse").val(),f=$.trim($("#teachingtaskcourse").val());if(""==c)$("#teachingtaskbasecourseMsg").show();else if(pattern.test(f)){var e=$("#datepicker8").val();if(""==e)$("#datepicker8Msg").show();else{var g=$("#datepicker9").val();""!=g&&(new Date(e)).getTime()>(new Date(g)).getTime()||$.ajax({url:contextPath+"/teacher/getplandetail",type:"post",data:{id:d},success:function(h){if(h.success){h=eval("("+h.other+")");if(0==h.length)return alert("\u83b7\u53d6\u4e0d\u5230\u57f9\u517b\u65b9\u6848\u76f8\u5173\u4fe1\u606f"),!1;$.ajax({url:contextPath+"/teacher/saveteachingtask",type:"post",data:{basecoursename:c,plandetailid:d,coursename:f,starttime:e,endtime:g,teaid:teaid,orgid:orgid,yearly:b,allhours:h.alllessons,practicehours:h.practices,xf:h.credit,copyid:a},success:function(a){a.success?location.href=contextPath+"/mycourse/"+a.other+"/info":alert(a.msg)}})}}})}}else $("#teachingtaskcourseMsg").show()}}else{var k=$("#isaddbc").val(),l=$.trim($("#bcourseinput").val()),m=$("#bcourse").val();if(1!=k||pattern.test(l))if(1!=k&&-1==m)$("#bcourseinputMsg").show();else{var n=$.trim($("#ordername2").val());if(pattern.test(n))if(e=$("#datepicker3").val(),""==e)$("#datepicker3Msg").show();else{if(g=$("#datepicker4").val(),!(""!=g&&(new Date(e)).getTime()>(new Date(g)).getTime())){var p=$("input[name\x3d'ispublic']:checked").val();$.ajax({url:contextPath+"/teacher/saveco",type:"post",data:{bcid:m,ordername:n,teaid:teaid,etime:g,stime:e,isaddbc:k,bcname:l,orgid:orgid,ispublic:p,copyid:a},success:function(a){a.success?location.href=contextPath+"/mycourse/"+a.other+"/info":alert(a.msg)}})}}else $("#ordername2Msg").show()}else $("#bcourseinputMsg1").show()}}function showplus(){$("#minus").show();$("#plus").hide();$("#bcourseinput").show();$("#bcourse").hide();$("#bcourseinput").focus();$("#isaddbc").val(1);$("#bcourseinput").val("");$("#bcourseinputMsg1").hide();$("#bcourseinputMsg").hide();$("#hideOrderSel").hide();$("#orderSel").val("-1")}function showminus(){$("#plus").show();$("#minus").hide();$("#bcourseinput").hide();$("#bcourse").show();$("#bcourseinput").blur();$("#isaddbc").val(-1);$("#bcourseinputMsg1").hide();$("#bcourseinputMsg").hide();$("#hideOrderSel").show()}function initPlan(){$.ajax({url:contextPath+"/teacher/getplantree",data:{orgid:orgid},type:"post",success:function(a){a.success&&($("#tree2").html(a.other),$("#tree2").dynatree({checkbox:!1,selectMode:1,onSelect:function(a,c){var d;d=c.tree.getSelectedNodes();d=$.map(d,function(a){return"["+a.data.key+"]"});return $("#echoSelection2").text(d.join(", "))},onClick:function(a,c){if("title"===a.getEventTargetType(c)){if(a.data.isFolder)return a.toggleSelect(),$("#tree2Msg").show(),!1;saveplan(a)}},onKeydown:function(a,c){if(32===c.which)return a.toggleSelect(),$("#tree2Msg").show(),!1},idPrefix:"dynatree-Cb2-"}))}})}function showMenu(){$("#menuContent").css({left:"15px",top:"30px"}).slideDown("fast");$("body").bind("mousedown",onBodyDown)}function hideMenu(){$("#menuContent").fadeOut("fast");$("body").unbind("mousedown",onBodyDown)}function onBodyDown(a){"chooseplan"==a.target.id||"menuContent"==a.target.id||0<$(a.target).parents("#menuContent").length?$("#tree2Msg").hide():hideMenu()}function saveplan(a){var b=a.data.key;a=a.data.title;0<b&&(hideMenu(),$("#chooseplan").val(a),$("#planid").val(b),initTeachingTaskBaseCourse())}function initTeachingTaskBaseCourse(){var a=$("#planid").val(),b=$("#yearly").val();$.ajax({url:contextPath+"/teacher/plandetailnames",type:"post",data:{planid:a,yearly:b},success:function(a){if(a.success){var b="";a=eval("("+a.other+")");if(null!=a)for(var f=0,e=a.length;f<e;f++)b+="\x3coption value\x3d '"+a[f].id+"' \x3e"+a[f].coursename+"\x3c/option\x3e";$("#teachingtaskbasecourse").html(b);getCourse4Teaching();$("#teachingtaskbasecourseMsg").hide()}}})};